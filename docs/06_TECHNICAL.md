# üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞–º–∏ DOCX.

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
2. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –∏—Ö —Ñ—É–Ω–∫—Ü–∏–∏](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-–∏-–∏—Ö-—Ñ—É–Ω–∫—Ü–∏–∏)
3. [–û–±—Ä–∞–±–æ—Ç–∫–∞ DOCX –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-docx-–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
4. [–°–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è](#—Å–∏—Å—Ç–µ–º–∞-—Ö—Ä–∞–Ω–µ–Ω–∏—è)
5. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö)
6. [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è](#–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å-–∏-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
7. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ë—Ä–∞—É–∑–µ—Ä (–ö–ª–∏–µ–Ω—Ç)                    ‚îÇ
‚îÇ  HTML5 / JavaScript / CSS3 / PDF.js                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ HTTP/REST
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              FastAPI –°–µ—Ä–≤–µ—Ä (Python)                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ API Layer (/api/...)                               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ - Endpoints REST                                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ - –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤                           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫                                 ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ Business Logic Layer                               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ - processor.py (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ - parser.py (–ø–∞—Ä—Å–∏–Ω–≥ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö)                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ - storage.py (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ - models.py (–º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö)                        ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            –•—Ä–∞–Ω–∏–ª–∏—â–µ (docx_templates_storage/)          ‚îÇ
‚îÇ  ‚îú‚îÄ collections.json (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–π)            ‚îÇ
‚îÇ  ‚îú‚îÄ templates.json (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω–æ–≤)               ‚îÇ
‚îÇ  ‚îú‚îÄ templates/ (DOCX —Ñ–∞–π–ª—ã)                            ‚îÇ
‚îÇ  ‚îú‚îÄ rendered/ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞)                  ‚îÇ
‚îÇ  ‚îî‚îÄ temp_*/ (–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è |
|-----------|-----------|--------|
| Backend | FastAPI | 0.124.0 |
| –ü–∞—Ä—Å–∏–Ω–≥ XML | lxml | 6.0.2 |
| –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ | zipfile | —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è |
| –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PDF | docx2pdf | 0.1.8 |
| Frontend | HTML5/CSS3/JS | —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ |
| PDF Viewer | PDF.js | 3.11.174 |

---

## üîå –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –∏—Ö —Ñ—É–Ω–∫—Ü–∏–∏

### 1. API Layer (api.py)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è

**–û—Å–Ω–æ–≤–Ω—ã–µ endpoints:**

```python
POST /api/collections              # –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
GET /api/collections               # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞
DELETE /api/collections/{id}       # –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏

POST /api/templates/upload         # –ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–∞
GET /api/templates/{collection_id} # –°–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤
DELETE /api/templates/{template_id}# –£–¥–∞–ª–µ–Ω–∏–µ

POST /api/render                   # –ï–¥–∏–Ω–∏—á–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
POST /api/render/batch             # –ú–∞—Å—Å–æ–≤—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
POST /api/render/preview           # PDF –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
```

**–ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞:**

```
–í—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å:
POST /api/collections
Body: {"name": "–ú–æ–∏ –¥–æ–≥–æ–≤–æ—Ä—ã"}
      ‚Üì
API Layer –ø–∞—Ä—Å–∏—Ç JSON
      ‚Üì
–í—ã–∑—ã–≤–∞–µ—Ç storage.create_collection()
      ‚Üì
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON –æ—Ç–≤–µ—Ç
      ‚Üì
HTTP 200 OK
```

### 2. Storage Layer (storage.py)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π:**

```python
@dataclass
class Collection:
    id: str                                  # UUID
    name: str                                # –ù–∞–∑–≤–∞–Ω–∏–µ
    templates: list['DocumentTemplate']     # –°–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤
    variables: list['TemplateVariable']     # –û–±—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    created_at: datetime                    # –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
```

**–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ JSON:**

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "–î–æ–≥–æ–≤–æ—Ä—ã 2026",
  "created_at": "2026-01-12T15:30:00",
  "templates": [
    {
      "id": "template-001",
      "name": "–¥–æ–≥–æ–≤–æ—Ä_–æ–∫–∞–∑–∞–Ω–∏—è_—É—Å–ª—É–≥",
      "variables": [...]
    }
  ],
  "variables": [...]
}
```

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**

```python
# –ö–æ–ª–ª–µ–∫—Ü–∏–∏
storage.create_collection(name)
storage.get_collection(collection_id)
storage.get_all_collections()
storage.delete_collection(collection_id)

# –®–∞–±–ª–æ–Ω—ã
storage.save_template(collection_id, template)
storage.get_template(template_id)
storage.get_templates_by_collection(collection_id)
storage.delete_template(template_id)
```

### 3. Processor Layer (processor.py)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

**–ö–ª–∞—Å—Å: CommentsDocumentProcessor**

–û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å –º–µ—Ç–æ–¥–∞–º–∏:

```python
class CommentsDocumentProcessor:
    
    def scan_template(self, docx_path):
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑ —à–∞–±–ª–æ–Ω–∞"""
        # –ü–∞—Ä—Å–∏—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
        # –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç legacy checkboxes
        # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    
    def render_document(self, template_path, data_dict):
        """–°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏"""
        # –û—Ç–∫—Ä—ã–≤–∞–µ—Ç DOCX
        # –ó–∞–º–µ–Ω—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π DOCX
    
    def docx_to_pdf(self, docx_path):
        """–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è DOCX –≤ PDF"""
        # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç docx2pdf
        # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Ç—å –∫ PDF
    
    def find_and_inject_legacy_checkboxes(self, docx_path):
        """–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö checkboxes"""
        # –ò—â–µ—Ç —Å–∏–º–≤–æ–ª—ã ‚òë‚òê‚úì‚úî
        # –°–æ–∑–¥–∞–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏-–º–∞—Ä–∫–µ—Ä—ã
        # –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π DOCX
    
    def render_documents_batch(self, template_path, data_list):
        """–ú–∞—Å—Å–æ–≤—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥"""
        # –î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        # –°–æ–∑–¥–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
        # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ DOCX:**

```python
def _unzip_docx(docx_path):
    """–†–∞—Å–ø–∞–∫–æ–≤–∫–∞ DOCX –∞—Ä—Ö–∏–≤–∞"""
    # DOCX - —ç—Ç–æ ZIP –∞—Ä—Ö–∏–≤
    # –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –≤ temp –ø–∞–ø–∫—É
    # –†–∞–±–æ—Ç–∞–µ–º —Å XML —Ñ–∞–π–ª–∞–º–∏
    # –ü–µ—Ä–µ–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ

def _rezip_docx(temp_path, output_path):
    """–ü–µ—Ä–µ—É–ø–∞–∫–æ–≤–∫–∞ DOCX –∞—Ä—Ö–∏–≤–∞"""
    # –ë–µ—Ä–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
    # –£–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –≤ ZIP
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ DOCX
```

### 4. Parser Layer (parser.py)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ø–∞—Ä—Å–∏–Ω–≥ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

**–ö–ª–∞—Å—Å: CommentsParser**

```python
class CommentsParser:
    
    def extract_comments(self, xml_tree):
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏–∑ XML"""
        # –ü–∞—Ä—Å–∏—Ç document.xml
        # –ò—â–µ—Ç —Ç–µ–≥–∏ <w:comment>
        # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
    
    def parse_comment(self, comment_text):
        """–ü–∞—Ä—Å–∏–Ω–≥ —Ñ–æ—Ä–º–∞—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π"""
        # –í—Ö–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–∞—Ç: "type\\name\\options"
        # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: (type, name, options)
        # –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç
    
    def find_legacy_checkboxes(self, xml_tree):
        """–ü–æ–∏—Å–∫ —Å—Ç–∞—Ä—ã—Ö checkboxes"""
        # –ò—â–µ—Ç Unicode —Å–∏–º–≤–æ–ª—ã ‚òë‚òê‚úì‚úî
        # –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–∑–∏—Ü–∏—é –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
        # –°–æ–∑–¥–∞–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    
    def inject_virtual_comments(self, xml_tree, checkboxes):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤"""
        # –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ checkbox
        # –°–æ–∑–¥–∞–µ—Ç XML —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        # –í—Å—Ç–∞–≤–ª—è–µ—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ
```

**–§–æ—Ä–º–∞—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è:**

```
text\\–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è_–Ω–∞–∑–≤–∞–Ω–∏–µ
text\\–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è\\option=value
date\\–¥–∞—Ç–∞_–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
date\\–¥–∞—Ç–∞_–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è\\format=dd.MM.yyyy
checkbox\\—Ñ–ª–∞–≥_–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
checkbox\\—Ñ–ª–∞–≥_–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è\\default=true
```

### 5. Models (models.py)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö

**–ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è:**

```python
class VariableType(Enum):
    TEXT = "text"
    DATE = "date"
    CHECKBOX = "checkbox"
```

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã:**

```python
@dataclass
class TemplateVariable:
    name: str                    # –ò–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
    type: VariableType           # –¢–∏–ø (text/date/checkbox)
    comment_ids: list[str]       # ID –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)
    contexts: list[str]          # –ö–æ–Ω—Ç–µ–∫—Å—Ç (—Ç–µ–∫—Å—Ç –≤–æ–∫—Ä—É–≥)
    occurrences: int             # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ö–æ–∂–¥–µ–Ω–∏–π
    locations: list[dict]        # –ü–æ–∑–∏—Ü–∏–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ

@dataclass
class DocumentTemplate:
    id: str                      # UUID —à–∞–±–ª–æ–Ω–∞
    name: str                    # –ò–º—è —Ñ–∞–π–ª–∞
    variables: list[TemplateVariable]  # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    collection_id: str           # ID –∫–æ–ª–ª–µ–∫—Ü–∏–∏
    file_hash: str               # –•—ç—à —Ñ–∞–π–ª–∞ (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏)
```

---

## üì¶ –û–±—Ä–∞–±–æ—Ç–∫–∞ DOCX –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ DOCX

DOCX —Ñ–∞–π–ª - —ç—Ç–æ ZIP –∞—Ä—Ö–∏–≤ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

```
–¥–æ–≥–æ–≤–æ—Ä.docx (—ç—Ç–æ ZIP –∞—Ä—Ö–∏–≤)
‚îú‚îÄ _rels/
‚îÇ  ‚îú‚îÄ .rels
‚îÇ  ‚îî‚îÄ document.xml.rels
‚îú‚îÄ word/
‚îÇ  ‚îú‚îÄ document.xml          ‚Üê –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
‚îÇ  ‚îú‚îÄ comments.xml          ‚Üê –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–≤–∞–∂–Ω–æ!)
‚îÇ  ‚îú‚îÄ footnotes.xml         ‚Üê –°–Ω–æ—Å–∫–∏
‚îÇ  ‚îú‚îÄ numbering.xml         ‚Üê –ù—É–º–µ—Ä–∞—Ü–∏—è
‚îÇ  ‚îú‚îÄ styles.xml            ‚Üê –°—Ç–∏–ª–∏
‚îÇ  ‚îú‚îÄ media/
‚îÇ  ‚îÇ  ‚îú‚îÄ image1.png
‚îÇ  ‚îÇ  ‚îî‚îÄ image2.jpg
‚îÇ  ‚îî‚îÄ theme/
‚îÇ     ‚îî‚îÄ theme1.xml
‚îú‚îÄ docProps/
‚îÇ  ‚îú‚îÄ core.xml              ‚Üê –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
‚îÇ  ‚îî‚îÄ app.xml
‚îú‚îÄ xl/                      ‚Üê –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü—ã
‚îî‚îÄ [Content_Types].xml      ‚Üê –¢–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞
```

### –ü–∞—Ä—Å–∏–Ω–≥ XML

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ lxml:**

```python
from lxml import etree

# –ó–∞–≥—Ä—É–∑–∏—Ç—å XML
tree = etree.parse('word/document.xml')
root = tree.getroot()

# –ü–æ–∏—Å–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (—Å namespace)
ns = {
    'w': 'http://schemas.openxmlformats.org/wordprocessingml/2006/main'
}

# –ù–∞–π—Ç–∏ –≤—Å–µ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã
paragraphs = root.findall('.//w:p', ns)

# –ù–∞–π—Ç–∏ —Ç–µ–∫—Å—Ç
for para in paragraphs:
    texts = para.findall('.//w:t', ns)
    for text in texts:
        print(text.text)
```

**–ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:**

```python
# –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ comments.xml
comments_tree = etree.parse('word/comments.xml')

# –ö–∞–∂–¥—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏–º–µ–µ—Ç ID –∏ —Ç–µ–∫—Å—Ç
for comment in comments_tree.findall('.//w:comment', ns):
    comment_id = comment.get('{%s}id' % w_ns)
    comment_text = comment.findall('.//w:t', ns)
    text_content = ''.join(t.text for t in comment_text if t.text)
    print(f"Comment {comment_id}: {text_content}")
```

### –ó–∞–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

**–ê–ª–≥–æ—Ä–∏—Ç–º –∑–∞–º–µ–Ω—ã:**

```python
def replace_variables(document_xml, data_dict):
    """
    1. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ:
       - –ü–æ–ª—É—á–∏—Ç—å —Ç–∏–ø –∏ –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
       - –ù–∞–π—Ç–∏ –¥–∏–∞–ø–∞–∑–æ–Ω —Ç–µ–∫—Å—Ç–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π —É–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
       - –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ data_dict
       - –ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    
    2. –û–±—Ä–∞–±–æ—Ç–∫–∞ checkboxes:
       - –î–ª—è –∫–∞–∂–¥–æ–≥–æ checkbox –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
       - –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ true ‚Üí –∑–∞–º–µ–Ω–∏—Ç—å ‚òê –Ω–∞ ‚òë
       - –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ false ‚Üí –æ—Å—Ç–∞–≤–∏—Ç—å ‚òê
    
    3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π XML
    """
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–º–µ–Ω—ã:**

```
–ò—Å—Ö–æ–¥–Ω—ã–π XML:
<w:p>
  <w:commentRangeStart w:id="0"/>
  <w:r>
    <w:t>[–¥–∞—Ç–∞]</w:t>
  </w:r>
  <w:commentRangeEnd w:id="0"/>
  <w:r>
    <w:annotationRef w:id="0"/>
  </w:r>
</w:p>

–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: "date\\–¥–∞—Ç–∞_–¥–æ–≥–æ–≤–æ—Ä–∞"
–î–∞–Ω–Ω—ã–µ: {"–¥–∞—Ç–∞_–¥–æ–≥–æ–≤–æ—Ä–∞": "12.01.2026"}

–†–µ–∑—É–ª—å—Ç–∞—Ç:
<w:p>
  <w:r>
    <w:t>12.01.2026</w:t>
  </w:r>
</w:p>

(–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É–¥–∞–ª–µ–Ω, —Ç–µ–∫—Å—Ç –∑–∞–º–µ–Ω–µ–Ω)
```

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ PDF

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ docx2pdf:**

```python
def docx_to_pdf(docx_path, pdf_path):
    """
    –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç DOCX –≤ PDF –∏—Å–ø–æ–ª—å–∑—É—è docx2pdf
    
    –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º:
    1. –°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç LibreOffice/OpenOffice
    2. –ò–ª–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã Windows
    3. –†–µ–∑—É–ª—å—Ç–∞—Ç - –≤–∞–ª–∏–¥–Ω—ã–π PDF —Ñ–∞–π–ª
    """
    from docx2pdf import convert
    convert(docx_path, pdf_path)
```

**–ü–æ—á–µ–º—É PDF –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞:**
- DOCX —Ç—Ä–µ–±—É–µ—Ç Word –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- PDF —É–Ω–∏–≤–µ—Ä—Å–∞–ª–µ–Ω - –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –ª—é–±–æ–º –±—Ä–∞—É–∑–µ—Ä–µ
- PDF.js –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—Å—Ç—Ä–æ–∏—Ç—å viewer –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø–ª–∞–≥–∏–Ω–æ–≤

---

## üíæ –°–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

```
docx_templates_storage/
‚îú‚îÄ collections.json              # JSON —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π
‚îú‚îÄ templates.json                # JSON —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ —à–∞–±–ª–æ–Ω–æ–≤
‚îú‚îÄ templates/                    # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã
‚îÇ  ‚îú‚îÄ collection_id_1/
‚îÇ  ‚îÇ  ‚îú‚îÄ template_1.docx
‚îÇ  ‚îÇ  ‚îú‚îÄ template_2.docx
‚îÇ  ‚îÇ  ‚îî‚îÄ template_3.docx
‚îÇ  ‚îî‚îÄ collection_id_2/
‚îÇ     ‚îî‚îÄ template_4.docx
‚îú‚îÄ rendered/                     # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
‚îÇ  ‚îú‚îÄ rendered_doc_20260112_143000.docx
‚îÇ  ‚îú‚îÄ rendered_doc_20260112_143025.pdf
‚îÇ  ‚îî‚îÄ rendered_doc_20260112_143101.zip
‚îî‚îÄ temp_uploads/                 # –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
   ‚îú‚îÄ upload_session_1/
   ‚îî‚îÄ upload_session_2/
```

### JSON —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö

**collections.json:**

```json
{
  "collections": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "name": "–î–æ–≥–æ–≤–æ—Ä—ã 2026",
      "created_at": "2026-01-12T15:30:00",
      "templates": [
        "template-001",
        "template-002"
      ],
      "variables": ["—Ñ–∞–º–∏–ª–∏—è", "–¥–∞—Ç–∞", "—Å—É–º–º–∞"]
    }
  ]
}
```

**templates.json:**

```json
{
  "templates": [
    {
      "id": "template-001",
      "name": "–¥–æ–≥–æ–≤–æ—Ä_–æ–∫–∞–∑–∞–Ω–∏—è_—É—Å–ª—É–≥.docx",
      "collection_id": "550e8400-...",
      "file_hash": "sha256_hash_here",
      "uploaded_at": "2026-01-12T15:30:00",
      "variables": [
        {
          "name": "—Ñ–∞–º–∏–ª–∏—è_–∫–ª–∏–µ–Ω—Ç–∞",
          "type": "text",
          "occurrences": 1,
          "contexts": ["–ö–ª–∏–µ–Ω—Ç: [—Ñ–∞–º–∏–ª–∏—è_–∫–ª–∏–µ–Ω—Ç–∞]"]
        }
      ]
    }
  ]
}
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä—É–µ—Ç:
- –û—Ç–∫—Ä—ã—Ç—ã–µ DOCX —Ñ–∞–π–ª—ã –≤ –ø–∞–º—è—Ç–∏ (–≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏)
- –†–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω—ã–µ XML (–≤–æ –≤—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞)
- –°–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞)

---

## üîç –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

```
1. –û–ë–ù–ê–†–£–ñ–ï–ù–ò–ï
   ‚îú‚îÄ –ó–∞–≥—Ä—É–∑–∫–∞ DOCX
   ‚îú‚îÄ –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ –∞—Ä—Ö–∏–≤–∞
   ‚îú‚îÄ –ü–∞—Ä—Å–∏–Ω–≥ XML
   ‚îî‚îÄ –ü–æ–∏—Å–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ + legacy checkboxes

2. –ü–ê–†–°–ò–ù–ì
   ‚îú‚îÄ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
   ‚îú‚îÄ –†–∞–∑–±–æ—Ä —Ñ–æ—Ä–º–∞—Ç–∞ (type\\name)
   ‚îú‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞
   ‚îî‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ TemplateVariable

3. –°–û–•–†–ê–ù–ï–ù–ò–ï
   ‚îú‚îÄ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
   ‚îú‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ JSON
   ‚îî‚îÄ –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞

4. –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï
   ‚îú‚îÄ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–µ
   ‚îú‚îÄ –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
   ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ data_dict

5. –ó–ê–ú–ï–ù–ê
   ‚îú‚îÄ –ó–∞–º–µ–Ω–∞ –≤ DOCX
   ‚îú‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ XML
   ‚îî‚îÄ –ü–µ—Ä–µ–ø–∞–∫–æ–≤–∫–∞ –∞—Ä—Ö–∏–≤–∞

6. –í–´–í–û–î
   ‚îú‚îÄ –ì–æ—Ç–æ–≤—ã–π DOCX —Å –¥–∞–Ω–Ω—ã–º–∏
   ‚îú‚îÄ PDF –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
   ‚îî‚îÄ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
```

### Legacy Checkboxes - —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

**–ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ:**

–°—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ Word –∏—Å–ø–æ–ª—å–∑—É—é—Ç –§–û–†–ú–£–ß–ï–ö–ë–û–ö–° (FORMCHECKBOX) –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞. –≠—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ–ª—è Word.

**–ö–∞–∫ –æ–Ω–∏ –≤—ã–≥–ª—è–¥—è—Ç:**
```
‚òê –°–æ–≥–ª–∞—Å–µ–Ω —Å —É—Å–ª–æ–≤–∏—è–º–∏
‚òë –•–æ—á—É –ø–æ–ª—É—á–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É
```

**–ö–∞–∫ —Å–∏—Å—Ç–µ–º–∞ –∏—Ö –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç:**

1. **–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞** - –∏—â–µ—Ç Unicode —Å–∏–º–≤–æ–ª—ã ‚òë‚òê‚úì‚úî
2. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏** - –Ω–∞—Ö–æ–¥–∏—Ç, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–∏–º–≤–æ–ª –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
3. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π** - —Å–æ–∑–¥–∞–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π checkbox
4. **–ò–Ω—ä–µ–∫—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è** - –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π-–º–∞—Ä–∫–µ—Ä –≤ XML

**–ü—Ä–∏–º–µ—Ä –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è:**

```python
# –ù–∞–π—Ç–∏ –≤—Å–µ checkboxes
checkboxes_symbols = ['‚òë', '‚òê', '‚úì', '‚úî', '‚òí']

for symbol in checkboxes_symbols:
    if symbol in text:
        # –ù–∞–π–¥–µ–Ω checkbox!
        position = text.index(symbol)
        
        # –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç (5 —Å–ª–æ–≤ —Å–ª–µ–≤–∞)
        context = get_context(text, position, 5)
        
        # –°–æ–∑–¥–∞—Ç—å –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
        var_name = f"checkbox_legacy_{counter}"
        
        # –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
        variables.append(TemplateVariable(
            name=var_name,
            type=VariableType.CHECKBOX,
            locations=[position]
        ))
```

---

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç |
|----------|-------|-----------|
| –ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–∞ (5 –ú–ë) | 1-2 —Å–µ–∫ | –†–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ |
| –ü–∞—Ä—Å–∏–Ω–≥ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö | 0.5 —Å–µ–∫ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ |
| –ï–¥–∏–Ω–∏—á–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ | 2-5 —Å–µ–∫ | –†–∞–∑–º–µ—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ |
| –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ PDF | 3-5 —Å–µ–∫ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–∞–Ω–∏—Ü |
| –ú–∞—Å—Å–æ–≤—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ (10 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤) | 20-50 —Å–µ–∫ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ |

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:**
```python
# –ú–∞—Å—Å–æ–≤—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ—Å—Ç—å
from multiprocessing import Pool

def render_documents_parallel(documents):
    with Pool(processes=4) as pool:
        results = pool.map(render_single_document, documents)
    return results
```

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# –ö—ç—à–∏—Ä—É—é—Ç—Å—è:
- –†–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω—ã–µ DOCX (–≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏)
- –†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ XML (–≤–æ –≤—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞)
- –°–ø–∏—Å–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –æ–¥–∏–Ω —Ä–∞–∑)
```

**–õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞:**
```python
# –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- PDF –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä"
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ä—Å—è—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–∞
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, –∞ –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤:**
```python
def validate_docx_file(file_path):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
    if not file_path.endswith('.docx'):
        raise ValueError("–¢–æ–ª—å–∫–æ DOCX —Ñ–∞–π–ª—ã")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ ZIP
    if not zipfile.is_zipfile(file_path):
        raise ValueError("–§–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
    if 'word/document.xml' not in zf.namelist():
        raise ValueError("–ù–µ –≤–∞–ª–∏–¥–Ω—ã–π DOCX —Ñ–æ—Ä–º–∞—Ç")
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```python
def validate_user_data(data_dict, template_variables):
    for var in template_variables:
        if var.name not in data_dict:
            raise ValueError(f"–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è {var.name} –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞")
        
        value = data_dict[var.name]
        
        # –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞
        if var.type == VariableType.DATE:
            validate_date(value)
        elif var.type == VariableType.CHECKBOX:
            validate_bool(value)
```

### –ó–∞—â–∏—Ç–∞ –æ—Ç –∏–Ω—ä–µ–∫—Ü–∏–π

**XML –∏–Ω—ä–µ–∫—Ü–∏—è:**
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ lxml —Å sanitization
from lxml import etree

# XML –ø–∞—Ä—Å–∏—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ
tree = etree.fromstring(xml_content, parser=etree.XMLParser(
    remove_blank_text=True,
    resolve_entities=False,  # –ó–∞—â–∏—Ç–∞ –æ—Ç XXE
    remove_comments=False
))
```

**–ò–∑–æ–ª—è—Ü–∏—è —Ñ–∞–π–ª–æ–≤:**
```python
# –ö–∞–∂–¥—ã–π uploaded —Ñ–∞–π–ª –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
# –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–∞–ø–∫–µ
# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
```

### –ö–æ–¥–∏—Ä–æ–≤–∫–∞

**UTF-8 –≤–µ–∑–¥–µ:**
```python
# –í—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–¥–∏—Ä—É—é—Ç—Å—è –≤ UTF-8
# JSON —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å encoding='utf-8'
# DOCX XML –∏—Å–ø–æ–ª—å–∑—É–µ—Ç UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫—É
```

---

## üìä –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

### –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

```
–ú—è–≥–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ):
- –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: –¥–æ 50 MB (–º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–ª–µ–∫—Ü–∏–π: –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–±–ª–æ–Ω–æ–≤ –Ω–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—é: –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ

–ñ–µ—Å—Ç–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –ü–∞–º—è—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ (–¥–ª—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏ DOCX)
- –ú–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ (–¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
- –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä (–¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ PDF)
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

```
–ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (Celery, RQ)
2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ batch –æ–ø–µ—Ä–∞—Ü–∏–π
3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ PDF (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å headless –±—Ä–∞—É–∑–µ—Ä)
4. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ CDN
5. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º
```

---

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:**
- –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](./02_USER_GUIDE.md)
- API —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫: [API –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫](./07_API_REFERENCE.md)
- –¢–∏–ø—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: [–¢–∏–ø—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö](./04_VARIABLE_TYPES.md)

---

**–í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è**: 35 –º–∏–Ω—É—Ç  
**–£—Ä–æ–≤–µ–Ω—å**: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π
